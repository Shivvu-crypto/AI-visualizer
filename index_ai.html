<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Data Visualizer</title>
    <!-- 1. Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple loader for the submit button */
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-2xl p-6 md:p-10">
        
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2 text-center">AI-Powered Data Visualizer</h1>
        <p class="text-lg text-gray-600 mb-8 text-center">From News Articles to Insightful Graphs, Instantly.</p>

        <!-- The Main Form -->
        <!-- We add an 'onsubmit' event to show the loader -->
        <form action="/" method="post" onsubmit="showLoader()">
            
            <label for="article_input" class="block text-xl font-semibold text-gray-700 mb-3">
                Step 1: Paste a News Article Below
            </label>

            <textarea name="article_content" id="article_input" rows="15" class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-base" placeholder="Paste your full article text here..." required></textarea>
            
            <button id="submit-button" type="submit" class="w-full mt-5 bg-blue-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out flex items-center justify-center space-x-3 text-lg">
                <span id="button-text">Generate Visualization âœ¨</span>
                <div id="loader" class="loader hidden"></div>
            </button>
        </form>

        <!-- 
          THIS IS THE DYNAMIC PART
          These sections will ONLY appear if the Python backend
          sends them (i.e., after you submit the form).
        -->

        <!-- 1. The Error Message Section -->
        {% if error_message %}
            <div class="mt-10 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                <strong class="font-bold">An Error Occurred:</strong>
                <span class="block">{{ error_message }}</span>
            </div>
        {% endif %}

        <!-- 2. The Graph Section -->
        {% if graph_html %}
            <div class="mt-12 border-t-2 pt-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Step 2: Generated Visualization</h2>
                <!-- This is where the Plotly graph is injected -->
                <div class="border rounded-lg shadow-md overflow-hidden">
                    {{ graph_html | safe }}
                </div>
            </div>
        {% endif %}

        <!-- 3. The Raw Data Section -->
        {% if extracted_data %}
            <div class="mt-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-3">Extracted Raw Data (CSV)</h3>
                <pre class="w-full p-4 bg-gray-50 border border-gray-200 rounded-lg shadow-inner overflow-auto max-h-60 whitespace-pre-wrap font-mono text-sm text-gray-700">{{ extracted_data }}</pre>
            </div>
        {% endif %}
        
    </div>

    <!-- JavaScript to show the loader -->
    <script>
        function showLoader() {
            document.getElementById('button-text').textContent = 'Processing... Please Wait...';
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('submit-button').disabled = true;
        }
    </script>

</body>
</html>